"use strict";(self.webpackChunkhmis=self.webpackChunkhmis||[]).push([[709],{709:(e,s,t)=>{t.r(s),t.d(s,{default:()=>i});var r=t(43),a=t(533),n=t(253),o=t(351),d=t(128),l=t(579);const i=()=>{const[e,s]=(0,r.useState)(""),[t,i]=(0,r.useState)(""),[c,m]=(0,r.useState)(""),[h,f]=(0,r.useState)([]),[u,p]=(0,r.useState)([]),[x,g]=(0,r.useState)([]),[b,N]=(0,r.useState)(!1),[j,v]=(0,r.useState)(null),[y,D]=(0,r.useState)(""),[k,$]=(0,r.useState)(""),[w,S]=(0,r.useState)(new Date),[I,Y]=(0,r.useState)(null),C=(sessionStorage.getItem("token")||localStorage.getItem("token"),function(e){$({message:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",onClose:()=>{$(null)}})});(0,r.useEffect)((()=>{M()}),[]),(0,r.useEffect)((()=>{e&&A()}),[e]),(0,r.useEffect)((()=>{e&&c&&E()}),[e,t,c,x]);const M=async()=>{N(!0);try{const e=await(0,n.iq)(`${a.$q}/getAll/1`);if(200===e.status&&Array.isArray(e.response)){const s=e.response.filter((e=>e.departmentTypeName===`${a.$5}`));f(e.response),p(s)}else console.error("Unexpected API response format:",e),f([]),p([])}catch(e){console.error("Error fetching Department data:",e)}finally{N(!1)}},A=async()=>{N(!0);try{const s=await(0,n.iq)(`${a.WX}/doctorBySpeciality/${e}`);200===s.status&&Array.isArray(s.response)?g(s.response):(console.error("Unexpected API response format:",s),g([]))}catch(s){console.error("Error fetching Doctor data:",s)}finally{N(!1)}},E=async()=>{if(e&&c)try{N(!0);const s=new URLSearchParams({deptId:e,rosterDate:c});t&&s.append("doctorId",t);const r=`${a._}/rosterfindWithDays?${s.toString()}`,o=await(0,n.iq)(r),d=(()=>{if(!c)return[];const e=new Date(c),s=new Date;s.setHours(0,0,0,0);const r=[];for(let t=0;t<7;t++){const a=new Date(e);if(a.setDate(e.getDate()+t),a.setHours(0,0,0,0),a>s){const e=`${a.getDate().toString().padStart(2,"0")}/${(a.getMonth()+1).toString().padStart(2,"0")}/${a.getFullYear()}`;r.push(e)}}let a=[];if(t){const e=x.find((e=>e.userId===parseInt(t)));e&&(a=[{name:`${e.firstName} ${e.lastName}`,id:e.userId}])}else a=x.map((e=>({name:`${e.firstName} ${e.lastName}`,id:e.userId})));return a.flatMap((e=>r.map((s=>({dates:s,rosterVale:"YY",doctorId:e.id,id:null,fromDatabase:!1,morningModified:!1,eveningModified:!1})))))})();let l=[];if(o.response&&o.response.dates){const e=o.response.dates.map((e=>({...e,fromDatabase:!0,morningModified:!1,eveningModified:!1}))),s=new Map;e.forEach((e=>{const t=`${e.doctorId}-${e.dates}`;s.set(t,e)})),l=d.map((e=>{const t=`${e.doctorId}-${e.dates}`;return s.get(t)||e})),e.forEach((e=>{const s=`${e.doctorId}-${e.dates}`;l.some((e=>`${e.doctorId}-${e.dates}`===s))||l.push(e)}))}else l=d;const i={departmentId:parseInt(e),fromDate:c,dates:l},m=JSON.parse(JSON.stringify(i));Y(m),v(i)}catch(s){console.error("Error preparing roster data:",s),C("Error preparing roster data","error")}finally{N(!1)}},R=(e,s,t)=>{if(U(s)<w)return;const r=j.dates.map((r=>{if(r.doctorId===e&&r.dates===s){let a;switch(r.rosterVale){case"YY":a="morning"===t?"NY":"YN";break;case"YN":a="morning"===t?"NN":"YY";break;case"NY":a="morning"===t?"YY":"NN";break;case"NN":a="morning"===t?"YN":"NY";break;default:a="YY"}const n=null===I||void 0===I?void 0:I.dates.find((t=>t.doctorId===e&&t.dates===s));if(n&&r.fromDatabase){const e=n.rosterVale,s="morning"===t?e.charAt(0)!==a.charAt(0):r.morningModified,o="evening"===t?e.charAt(1)!==a.charAt(1):r.eveningModified;return{...r,rosterVale:a,morningModified:s,eveningModified:o}}return{...r,rosterVale:a}}return r}));v((e=>({...e,dates:r})))},U=e=>{const[s,t,r]=e.split("/");return new Date(`${r}-${t}-${s}`)},q=e=>{if(!e)return"";const[s,t,r]=e.split("/");return new Date(`${r}-${t}-${s}`).toLocaleDateString("en-US",{day:"2-digit",month:"short",year:"numeric"})},V=()=>{s(""),i(""),m(""),v(null),Y(null)},P=e=>e.fromDatabase&&e.morningModified?{backgroundColor:"#ffd24d",borderColor:"#ffd24d"}:e.fromDatabase?{backgroundColor:"#55bf70",borderColor:"#55bf70"}:{},F=e=>e.fromDatabase&&e.eveningModified?{backgroundColor:"#ffd24d",borderColor:"#ffd24d"}:e.fromDatabase?{backgroundColor:"#55bf70",borderColor:"#55bf70"}:{};return(0,l.jsx)("div",{className:"body d-flex py-3",children:(0,l.jsxs)("div",{className:"container-xxl",children:[(0,l.jsx)("div",{className:"row align-items-center",children:(0,l.jsx)("div",{className:"border-0 mb-4",children:(0,l.jsx)("div",{className:"card-header py-3 bg-transparent d-flex align-items-center px-0 justify-content-between border-bottom flex-wrap",children:(0,l.jsx)("h3",{className:"fw-bold mb-0",children:"Doctor Roster"})})})}),k&&(0,l.jsx)(d.A,{message:k.message,type:k.type,onClose:k.onClose}),b&&(0,l.jsx)(o.A,{}),(0,l.jsx)("div",{className:"row mb-3",children:(0,l.jsx)("div",{className:"col-sm-12",children:(0,l.jsx)("div",{className:"card shadow mb-3",children:(0,l.jsx)("div",{className:"card-body",children:(0,l.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),e&&c){N(!0);try{const e=`${a._}/roster`,s={...j,dates:j.dates.map((e=>{let{fromDatabase:s,morningModified:t,eveningModified:r,...a}=e;return a}))},t=await(0,n.MB)(e,s);200===t.status?(C("Roster saved successfully!","success"),V(),E()):C(`Error saving roster: ${t.message||"Unknown error"}`,"error")}catch(t){console.error("Error saving roster:",t),C("An error occurred while saving the roster","error")}finally{N(!1)}}else C("Please select Department and From Date","error")},children:[(0,l.jsxs)("div",{className:"row g-3",children:[(0,l.jsxs)("div",{className:"col-md-4",children:[(0,l.jsx)("label",{className:"form-label",children:"Department *"}),(0,l.jsxs)("select",{className:"form-select",value:e,onChange:e=>s(parseInt(e.target.value)),required:!0,children:[(0,l.jsx)("option",{value:"",disabled:!0,children:"Select"}),u.map((e=>(0,l.jsx)("option",{value:e.id,children:e.departmentName},e.id)))]})]}),(0,l.jsxs)("div",{className:"col-md-4",children:[(0,l.jsx)("label",{className:"form-label",children:"Doctor (Optional)"}),(0,l.jsxs)("select",{className:"form-select",value:t,onChange:e=>i(e.target.value),disabled:!e,children:[(0,l.jsx)("option",{value:"",children:"All Doctors"}),x.map((e=>(0,l.jsxs)("option",{value:e.userId,children:[e.firstName," ",e.middleName," ",e.lastName]},e.userId)))]})]}),(0,l.jsxs)("div",{className:"col-md-4",children:[(0,l.jsx)("label",{className:"form-label",children:"From Date *"}),(0,l.jsx)("input",{type:"date",className:"form-control",value:c,onChange:e=>m(e.target.value),required:!0})]}),j&&(()=>{if(!j||!j.dates||0===j.dates.length)return null;const e=new Map;j.dates.forEach((s=>{e.has(s.doctorId)||e.set(s.doctorId,[]),e.get(s.doctorId).push(s)}));const s=[...new Set(j.dates.map((e=>e.dates)))].sort(((e,s)=>U(e)-U(s)));return(0,l.jsxs)("div",{className:"table-responsive",children:[(0,l.jsxs)("table",{className:"table table-bordered",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Doctor"}),s.map((e=>(0,l.jsxs)("th",{className:"text-center",children:[q(e),(0,l.jsx)("div",{className:"small text-muted",children:U(e).toLocaleDateString("en-US",{weekday:"short"})})]},e)))]})}),(0,l.jsx)("tbody",{children:[...e.entries()].map((e=>{let[t,r]=e;const a=x.find((e=>e.userId===t)),n=a?`${a.firstName} ${a.lastName}`:"Unknown Doctor";return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:n}),s.map((e=>{const s=r.find((s=>s.dates===e));if(!s)return(0,l.jsx)("td",{className:"text-center text-muted",children:"N/A"},e);const a=U(e)<w;const n=s.rosterVale;return(0,l.jsxs)("td",{className:"text-center",children:[(0,l.jsxs)("div",{className:"form-check form-check-inline",children:[(0,l.jsx)("input",{type:"checkbox",className:"form-check-input",checked:"YY"===n||"YN"===n,onChange:()=>R(t,e,"morning"),disabled:a,style:P(s)}),(0,l.jsx)("label",{className:"form-check-label "+(a?"text-muted":""),children:"M"})]}),(0,l.jsxs)("div",{className:"form-check form-check-inline",children:[(0,l.jsx)("input",{type:"checkbox",className:"form-check-input",checked:"YY"===n||"NY"===n,onChange:()=>R(t,e,"evening"),disabled:a,style:F(s)}),(0,l.jsx)("label",{className:"form-check-label "+(a?"text-muted":""),children:"E"})]})]},e)}))]},t)}))})]}),(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,l.jsx)("div",{style:{width:"20px",height:"20px",backgroundColor:"#55bf70",marginRight:"10px"}}),(0,l.jsx)("span",{children:"Data from database"})]}),(0,l.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,l.jsx)("div",{style:{width:"20px",height:"20px",backgroundColor:"#ffd24d",marginRight:"10px"}}),(0,l.jsx)("span",{children:"Modified database data"})]}),(0,l.jsxs)("div",{className:"d-flex align-items-center",children:[(0,l.jsx)("div",{style:{width:"20px",height:"20px",backgroundColor:"#0d6efd",marginRight:"10px"}}),(0,l.jsx)("span",{children:"New data"})]})]})]})})()]}),(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("button",{type:"submit",className:"btn btn-primary me-2",disabled:b||!j,children:b?"Processing...":"Save Roster"}),(0,l.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:V,disabled:b,children:"Reset"})]})]})})})})})]})})}}}]);
//# sourceMappingURL=709.ed32b6bf.chunk.js.map