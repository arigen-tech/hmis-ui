"use strict";(self.webpackChunkhmis=self.webpackChunkhmis||[]).push([[322],{253:(e,t,a)=>{a.d(t,{MB:()=>r,iq:()=>n});const s=a(533).QU,n=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a;a=localStorage.token?{Authorization:`Bearer ${localStorage.getItem("token")}`}:{Authorization:`Bearer ${sessionStorage.getItem("token")}`};const n=await fetch(`${s}${e}`,{method:"GET",headers:{"Content-Type":"application/json",...a,...t}});if(!n.ok)throw new Error(`GET request failed: ${n.status}`);return await n.json()}catch(a){throw console.error("GET Error:",a),a}},r=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let n;n=localStorage.token?{Authorization:`Bearer ${localStorage.getItem("token")}`}:{Authorization:`Bearer ${sessionStorage.getItem("token")}`};const r=await fetch(`${s}${e}`,{method:"POST",headers:{"Content-Type":"application/json",...n,...a},body:JSON.stringify(t)});if(!r.ok)throw new Error(`POST request failed: ${r.status}`);return await r.json()}catch(n){throw console.error("POST Error:",n),n}}},322:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var s=a(43),n=a(533),r=a(253),o=a(128),l=a(579);const i=()=>{const[e,t]=(0,s.useState)(""),[a,i]=(0,s.useState)(""),[c,d]=(0,s.useState)(""),[m,u]=(0,s.useState)(""),[h,p]=(0,s.useState)(""),[x,y]=(0,s.useState)(""),[f,j]=(0,s.useState)(""),[v,N]=(0,s.useState)(""),[g,b]=(0,s.useState)([]),[T,k]=(0,s.useState)([]),[S,I]=(0,s.useState)([]),[w,O]=(0,s.useState)(!1),[D,A]=(0,s.useState)(null),C=function(e){i({message:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",onClose:()=>{i(null)}})},$=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],E=$.reduce(((e,t)=>(e[t]={startToken:"",totalInterval:"",totalToken:"",totalOnlineToken:"",maxNoOfDays:"",minNoOfDays:""},e)),{}),[q,P]=(0,s.useState)(E);(0,s.useEffect)((()=>{B(),M()}),[]),(0,s.useEffect)((()=>{c&&U()}),[c]);const B=async()=>{O(!0);try{const e=await(0,r.iq)(`${n.Xw}/all`);200===e.status&&Array.isArray(e.response)?b(e.response):(console.error("Unexpected API response format:",e),b([]))}catch(e){console.error("Error fetching Department data:",e)}finally{O(!1)}},U=async()=>{O(!0);try{const e=await(0,r.iq)(`${n.Xw}/userDepartments/${c}`);200===e.status&&Array.isArray(e.response)?k(e.response):(console.error("Unexpected API response format:",e),k([]))}catch(e){console.error("Error fetching Doctor data:",e)}finally{O(!1)}},M=async()=>{O(!0);try{const e=await(0,r.iq)(`${n.fW}/all`);200===e.status&&Array.isArray(e.response)?I(e.response):(console.error("Unexpected API response format:",e),I([]))}catch(e){console.error("Error fetching Session data:",e)}finally{O(!1)}};console.log(T),(0,s.useEffect)((()=>{c&&m&&h&&z()}),[c,m,h]);const z=async()=>{try{O(!0);const e=`${n.Yc}/find?deptId=${c}&doctorId=${m}&sessionId=${h}`,t=await(0,r.iq)(e);if(200===(null===t||void 0===t?void 0:t.status)&&null!==t&&void 0!==t&&t.response){const{startTime:e,endTime:a,timeTaken:s,days:n}=t.response;if(A(t.response),y(e),j(a),N(s),Array.isArray(n)){const e={...E};n.forEach((t=>{const a=t.days||t.day;a&&e[a]&&(e[a]={startToken:t.startToken||"",totalInterval:t.totalInterval||"",totalToken:t.totalToken||"",totalOnlineToken:t.totalOnlineToken||"",maxNoOfDays:t.maxNoOfDays||"",minNoOfDays:t.minNoOfDays||""})})),P(e)}}else A(null),P(E)}catch(e){console.error("Error fetching appointment data:",e)}finally{O(!1)}},F=(e,t,a)=>{P({...q,[e]:{...q[e],[t]:a}})},G=()=>{d(""),u(""),p(""),y(""),j(""),N(""),P(E),A(null)};return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("div",{className:"body d-flex py-3",children:(0,l.jsxs)("div",{className:"container-xxl",children:[a&&(0,l.jsx)(o.A,{message:a.message,type:a.type,onClose:a.onClose}),(0,l.jsx)("div",{className:"row align-items-center",children:(0,l.jsx)("div",{className:"border-0 mb-4",children:(0,l.jsx)("div",{className:"card-header py-3 bg-transparent d-flex align-items-center px-0 justify-content-between border-bottom flex-wrap",children:(0,l.jsx)("h3",{className:"fw-bold mb-0",children:"Appointment Setup"})})})}),(0,l.jsx)("div",{className:"row mb-3",children:(0,l.jsx)("div",{className:"col-sm-12",children:(0,l.jsx)("div",{className:"card shadow mb-3",children:(0,l.jsx)("div",{className:"card-body",children:(0,l.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const t={id:D?D.id:null,departmentId:c,doctorId:m,sessionId:h,startTime:x,endTime:f,timeTaken:v,days:$.map((e=>{var t;const a=null===D||void 0===D||null===(t=D.days)||void 0===t?void 0:t.find((t=>(t.days||t.day)===e));return{id:D&&(null===a||void 0===a?void 0:a.id)||null,day:e,tokenStartNo:q[e].startToken,tokenInterval:q[e].totalInterval,totalToken:q[e].totalToken,totalOnlineToken:q[e].totalOnlineToken,maxNoOfDay:q[e].maxNoOfDays,minNoOfday:q[e].minNoOfDays}}))};console.log(t);try{O(!0);const e=await(0,r.MB)(`${n.Yc}/setup`,t);D&&200===e.status||!D&&201===e.status?(C(e.message||`Appointment ${D?"updated":"created"} successfully!`,"success"),G()):C(`Failed to ${D?"update":"create"} Appointment. Please try again.`,"error")}catch(a){C("An error occurred: "+(a.message||"Unknown error"),"error")}finally{O(!1)}},children:[(0,l.jsxs)("div",{className:"row g-3",children:[(0,l.jsxs)("div",{className:"col-md-4",children:[(0,l.jsx)("label",{className:"form-label",children:"Department *"}),(0,l.jsxs)("select",{className:"form-select",value:c,onChange:e=>d(parseInt(e.target.value)),required:!0,children:[(0,l.jsx)("option",{value:"",disabled:!0,children:"Select"}),g.map((e=>(0,l.jsx)("option",{value:e.id,children:e.departmentName},e.id)))]})]}),(0,l.jsxs)("div",{className:"col-md-4",children:[(0,l.jsx)("label",{className:"form-label",children:"Doctor List *"}),(0,l.jsxs)("select",{className:"form-select",value:m,onChange:e=>u(parseInt(e.target.value)),required:!0,disabled:!c,children:[(0,l.jsx)("option",{value:"",children:"Select Doctor"}),T.filter((e=>e.departmentId===parseInt(c))).map((e=>(0,l.jsx)("option",{value:e.userId,children:e.userName},e.userId)))]})]}),(0,l.jsxs)("div",{className:"col-md-4",children:[(0,l.jsx)("label",{className:"form-label",children:"Session *"}),(0,l.jsxs)("select",{className:"form-select",value:h,onChange:e=>p(parseInt(e.target.value)),required:!0,children:[(0,l.jsx)("option",{value:"",disabled:!0,children:"Select"}),S.map((e=>(0,l.jsx)("option",{value:e.id,children:e.sessionName},e.id)))]})]}),(0,l.jsxs)("div",{className:"col-md-4",children:[(0,l.jsx)("label",{className:"form-label",children:"Start Time *"}),(0,l.jsx)("input",{type:"time",className:"form-control",value:x,onChange:e=>y(e.target.value),required:!0})]}),(0,l.jsxs)("div",{className:"col-md-4",children:[(0,l.jsx)("label",{className:"form-label",children:"End Time *"}),(0,l.jsx)("input",{type:"time",className:"form-control",value:f,onChange:e=>j(e.target.value),required:!0})]}),(0,l.jsxs)("div",{className:"col-md-4",children:[(0,l.jsx)("label",{className:"form-label",children:"Time Taken (minutes) *"}),(0,l.jsx)("input",{type:"number",className:"form-control",value:v,onChange:e=>N(parseInt(e.target.value)),required:!0})]}),(0,l.jsx)("div",{className:"col-md-12",children:(0,l.jsxs)("table",{className:"table table-bordered",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Days"}),(0,l.jsx)("th",{children:"Token Start No."}),(0,l.jsx)("th",{children:"Token Interval"}),(0,l.jsx)("th",{children:"Total Token"}),(0,l.jsx)("th",{children:"Total Online Token"}),(0,l.jsx)("th",{children:"Max No. of Days"}),(0,l.jsx)("th",{children:"Min No. of Days"})]})}),(0,l.jsx)("tbody",{children:$.map((e=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:e}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"text",className:"form-control",value:q[e].startToken,onChange:t=>F(e,"startToken",parseInt(t.target.value)||0)})}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"text",className:"form-control",value:q[e].totalInterval,onChange:t=>F(e,"totalInterval",parseInt(t.target.value)||0)})}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"text",className:"form-control",value:q[e].totalToken,onChange:t=>F(e,"totalToken",parseInt(t.target.value)||0)})}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"text",className:"form-control",value:q[e].totalOnlineToken,onChange:t=>F(e,"totalOnlineToken",parseInt(t.target.value)||0)})}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"text",className:"form-control",value:q[e].maxNoOfDays,onChange:t=>F(e,"maxNoOfDays",parseInt(t.target.value)||0)})}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"text",className:"form-control",value:q[e].minNoOfDays,onChange:t=>F(e,"minNoOfDays",parseInt(t.target.value)||0)})})]},e)))})]})})]}),(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("button",{type:"submit",className:"btn btn-primary me-2",disabled:w,children:w?"Processing...":D?"Update Appointment":"Create Appointment"}),(0,l.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:G,children:"Reset"})]})]})})})})})]})})})}}}]);
//# sourceMappingURL=322.758402ce.chunk.js.map